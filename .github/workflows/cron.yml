name: Weekly 3-2-1 Intelligence Trigger

on:
  schedule:
    # Run every 3 hours on Monday (8 times per day instead of 24)
    # This covers all global timezones efficiently while reducing GitHub Action usage
    # Times: 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC
    - cron: '0 */3 * * 1'
  workflow_dispatch: # Allows manual triggering

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - name: Call Vercel Cron Endpoint
        run: |
          # Remove any potential trailing slashes from the secret
          CLEAN_URL=$(echo "${{ secrets.APP_URL }}" | sed 's:/*$::')
          echo "Connecting to: $CLEAN_URL/api/cron"
          
          # -L follows redirects! (Fixes 308 error)
          # -i shows response headers (for debugging)
          curl -i -L -X GET "$CLEAN_URL/api/cron" \
          -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          --fail
