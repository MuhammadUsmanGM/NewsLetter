name: Hourly Newsletter Trigger

on:
  schedule:
    - cron: '5 * * * *' # Every hour at minute 5
  workflow_dispatch: # Allows manual triggering

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - name: Call Vercel Cron Endpoint
        run: |
          # Remove any potential trailing slashes from the secret
          CLEAN_URL=$(echo "${{ secrets.APP_URL }}" | sed 's:/*$::')
          echo "Connecting to: $CLEAN_URL/api/cron"
          
          # -L follows redirects! (Fixes 308 error)
          # -i shows response headers (for debugging)
          curl -i -L -X GET "$CLEAN_URL/api/cron" \
          -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          --fail
